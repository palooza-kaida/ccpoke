import{d as i,y as M}from"./hooks.module.BVG3ayJl.js";import{g as R,R as U,L as j,E as T,M as L,G as b,t as d}from"./MarkdownBody.JDhMQieN.js";import{s as v,g as x}from"./storage.CvjnfjBm.js";import{u as n}from"./jsxRuntime.module.kJjLVEAC.js";import{k as A}from"./preact.module.EGlgVV74.js";/* empty css                          */function m(t){try{const a=new URL(t);return a.protocol==="https:"||a.protocol==="http:"}catch{return!1}}function E(){if(typeof window>"u")return null;const t=new URLSearchParams(window.location.search),a=t.get("id"),e=t.get("api");return!a||!e||!m(e)?null:{id:a,api:e,project:t.get("p")??"",duration:parseInt(t.get("d")??"0",10)}}async function u(t,a){try{const e=await fetch(`${t}/api/responses/${a}`);return e.ok?await e.json():null}catch{return null}}async function P(t){const a=await u(t.api,t.id);if(a)return v("tunnelUrl",t.api),{kind:"success",data:a};const e=x("tunnelUrl");if(e&&e!==t.api&&m(e)){const s=await u(e,t.id);if(s)return{kind:"success",data:s}}return{kind:"error",message:"expired"}}function G({locale:t}){const a=t??R(new URL(window.location.href)),[e,s]=i({kind:"loading"}),[f,c]=i(""),[g,p]=i(0),[w,h]=i(),[y,k]=i("");M(()=>{l(),S()},[]);function l(o=0){typeof Telegram<"u"&&Telegram?.WebApp?(Telegram.WebApp.ready(),Telegram.WebApp.expand()):o<10&&setTimeout(()=>l(o+1),300)}async function S(){const o=E();if(!o){s({kind:"error",message:d(a,"responseNotFound")});return}c(o.project),p(o.duration);try{const r=await P(o);if(r.kind!=="success"){s({kind:"error",message:d(a,"responseExpired")});return}r.data.projectName&&c(r.data.projectName),r.data.durationMs&&p(r.data.durationMs),r.data.timestamp&&h(r.data.timestamp),r.data.model&&k(r.data.model),s(r)}catch{s({kind:"error",message:d(a,"responseExpired")})}}return n("div",{class:"rv",children:n("main",{class:"rv__body",children:[n(U,{project:f,durationMs:g,timestamp:w,model:y,locale:a}),e.kind==="loading"&&n(j,{}),e.kind==="error"&&n(T,{message:e.message}),e.kind==="success"&&n(A,{children:[e.data.responseSummary&&n(L,{content:e.data.responseSummary}),n(b,{changes:e.data.gitChanges??[],locale:a})]})]})})}export{G as default};
