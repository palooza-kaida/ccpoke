import{d as i,y as w}from"./hooks.module.BVG3ayJl.js";import{R as h,L as S,E as M,M as j,G as T,t as d}from"./MarkdownBody.5AEolTQ7.js";import{s as R,g as b}from"./storage.CvjnfjBm.js";import{u as r}from"./jsxRuntime.module.kJjLVEAC.js";import{k as v}from"./preact.module.EGlgVV74.js";/* empty css                          */function x(){if(typeof window>"u")return null;const e=new URLSearchParams(window.location.search),t=e.get("id"),a=e.get("api");return!t||!a?null:{id:t,api:a,project:e.get("p")??"",duration:parseInt(e.get("d")??"0",10)}}async function u(e,t){try{const a=await fetch(`${e}/api/responses/${t}`);return a.ok?await a.json():null}catch{return null}}async function E(e){const t=await u(e.api,e.id);if(t)return R("tunnelUrl",e.api),{kind:"success",data:t};const a=b("tunnelUrl");if(a&&a!==e.api){const s=await u(a,e.id);if(s)return{kind:"success",data:s}}return{kind:"error",message:"expired"}}function W(){const[e,t]=i({kind:"loading"}),[a,s]=i(""),[m,c]=i(0),[l,f]=i(),[g,k]=i("");w(()=>{p(),y()},[]);function p(){typeof Telegram<"u"&&Telegram?.WebApp?(Telegram.WebApp.ready(),Telegram.WebApp.expand()):setTimeout(p,300)}async function y(){const o=x();if(!o){t({kind:"error",message:d("responseNotFound")});return}s(o.project),c(o.duration);try{const n=await E(o);if(n.kind!=="success"){t({kind:"error",message:d("responseExpired")});return}n.data.projectName&&s(n.data.projectName),n.data.durationMs&&c(n.data.durationMs),n.data.timestamp&&f(n.data.timestamp),n.data.model&&k(n.data.model),t(n)}catch{t({kind:"error",message:d("responseExpired")})}}return r("div",{class:"rv",children:r("main",{class:"rv__body",children:[r(h,{project:a,durationMs:m,timestamp:l,model:g}),e.kind==="loading"&&r(S,{}),e.kind==="error"&&r(M,{message:e.message}),e.kind==="success"&&r(v,{children:[e.data.responseSummary&&r(j,{content:e.data.responseSummary}),r(T,{changes:e.data.gitChanges??[]})]})]})})}export{W as default};
